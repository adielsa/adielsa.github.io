function formatDate(){var t=new Date,a=""+(t.getMonth()+1),e=""+t.getDate(),o=t.getFullYear();return a.length<2&&(a="0"+a),e.length<2&&(e="0"+e),[o,a,e].join("")}function add_time(t,e){train_path="",train_idx=0,t.Train.forEach(function(a){train_path+=a.DepartureTime+" => "+a.ArrivalTime,delay_int=0,e.Data.Delays.forEach(function(t){a.Trainno==t.Train&&(delay_int=t.Min,train_path+=" Delay:"+t.min)}),Deparute_dd=moment(a.DepartureTime,"DD/MM/YYYY H:mm:ss"),Deparute_d=Deparute_dd.toDate(),deparute_str=Deparute_dd.format("HH:mm"),Arrival_dd=moment(a.ArrivalTime,"DD/MM/YYYY H:mm:ss"),Arrival_d=Arrival_dd.toDate(),arrival_str=Arrival_dd.format("HH:mm"),time_left=Deparute_dd.fromNow(),delay_str=0<delay_int?delay_int:"",Deparute_dd.isBefore(moment())||(train_idx++,$("#table_train").append("<tr><td>"+deparute_str+"</td><td>"+arrival_str+"</td><td>"+delay_str+"</td><td>"+time_left+"</td></tr>"),show_message(""))})}function getjson_success(t){var a=t;R=a.Data.Routes,$("#table_train").find("tr:gt(0)").remove(),0<a.Data.Routes.length&&(show_message("Scanning"),a.Data.Routes.forEach(function(t){add_time(t,a)}))}function getjson_error(t){}function update_train(){var t=new Date,a=$("#from_station").val(),e=$("#dest_station").val(),o=[("0"+t.getHours()).slice(-2),("0"+t.getMinutes()).slice(-2)].join(""),n="https://www.rail.co.il/apiinfo/api/Plan/GetRoutes?OId="+a+"&TId="+e+"&Date="+formatDate()+"&Hour="+o+"&isGoing=true&c=1123231";a!==e?(show_message("Scanning..."),$.getJSON(n).done(function(t){var a=t;R=a.Data.Routes,$("#table_train").find("tr:gt(0)").remove(),0<a.Data.Routes.length?a.Data.Routes.forEach(function(t){add_time(t,a)}):show_message("No trains for today")}).fail(function(t,a,e){show_message("Fail connect to server")})):show_message("Error: Start and end station are the same")}var cnt_update=0;function auto_update_train(){$("#update_next").text(cnt_update),0==cnt_update?(cnt_update=60,update_train()):--cnt_update,setTimeout(auto_update_train,1e3)}function show_message(t){$("#message_loc").text(t)}function fill_from_select(t){for(var a in lstation=station,lstation)i=a,$("#"+t).append('<option value="'+i+'">'+station[i]+"</option>")}function changed_station_select(t){"localStorage"in window&&null!==window.localStorage&&(localStorage.setItem("from_station",$("#from_station").val()),localStorage.setItem("dest_station",$("#dest_station").val())),update_train()}$(function(){show_message("Loading"),fill_from_select("from_station"),fill_from_select("dest_station"),localStorage.dest_station?$("#dest_station").val(localStorage.getItem("dest_station")):$("#dest_station").val(8700),localStorage.from_station?$("#from_station").val(localStorage.getItem("from_station")):$("#from_station").val(4600),update_train(),setTimeout(auto_update_train,1e3)}),station={3600:"תל אביב - אוניברסיטה",3700:"תל אביב - סבידור מרכז",4600:"תל אביב - השלום",4900:"תל אביב - ההגנה",8700:"כפר סבא - נורדאו (א' קוסטיוק)",9200:"הוד השרון - סוקולוב",3500:"הרצליה",3400:"בית יהושע",3300:"נתניה",3100:"חדרה - מערב",2800:"בנימינה",2820:"קיסריה - פרדס חנה",2500:"עתלית",2200:"חיפה - בת גלים",1300:"חוצות המפרץ",700:"קריית חיים",1400:"קריית מוצקין",1500:"עכו",2300:"חיפה - חוף הכרמל (ש' רזיאל)",1600:"נהריה",6500:"ירושלים - גן החיות התנכי",6300:"בית שמש",7e3:"קריית גת",5e3:"לוד",7300:"באר שבע- צפון/אוניברסיטה",4800:'כפר חב"ד',2100:"חיפה- מרכז השמונה",5010:"רמלה",8800:"ראש העין - צפון",5300:"באר יעקב",5200:"רחובות (א' הדר) ",5410:"יבנה מזרח",9100:"ראשון לציון - הראשונים",5800:"אשדוד עד הלום (מ' בר כוכבא)",4250:"פתח תקווה - סגולה",4100:"בני ברק",7320:"באר שבע - מרכז",1220:"מרכזית המפרץ (לב המפרץ)",8600:"נמל תעופה בן גוריון",6700:"ירושלים - מלחה",5900:"אשקלון",7500:"דימונה",4170:"פתח תקווה  - קריית אריה",5150:"לוד גני אביב",8550:"להבים - רהט",300:"פאתי מודיעין",400:"מודיעין - מרכז",4640:"צומת חולון",4660:"חולון - וולפסון",4680:"בת ים - יוספטל",4690:"בת ים - קוממיות",9800:"ראשון לציון-משה דיין",9e3:"יבנה מערב",9600:"שדרות",9650:"נתיבות",9700:"אופקים",3310:"נתניה - ספיר",1240:"יקנעם - כפר יהושע",1250:"מגדל העמק - כפר ברוך",1260:"עפולה ר.איתן",1280:"בית שאן",1820:"אחיהוד",1840:"כרמיאל",2940:"רעננה מערב",2960:"רעננה דרום",6150:"קרית מלאכי - יואב",680:"ירושלים - יצחק נבון",6900:"מזכרת בתיה"};